
<p-confirmDialog   acceptLabel="بله" rejectLabel="خیر" [style]="{width: '50vw'}"></p-confirmDialog>





<p-table [columns]="cols" [value]="models"
         tableStyleClass="  container "


         selectionMode="single" [(selection)]="selectedModel"
          [paginator]="true" [rows]="15">
  <ng-template pTemplate="caption">

    <div class="row">
      <div class="col-4"></div>
      <div class="col-4">
        {{header}}
      </div>
      <div class="col-4">
        <p-button  (click)="reload()" icon="pi pi-refresh"></p-button>

      </div>
    </div>

  </ng-template>


  <ng-template pTemplate="header" let-columns>
    <tr>
      <th *ngFor="let col of columns" [pSortableColumn]="col.field">
        {{col.header}}
        <p-sortIcon [field]="col.field"></p-sortIcon>
      </th>
      <ng-template [ngTemplateOutlet]="columnHeaderContent" [ngTemplateOutletContext]="{$implicit: columns}"></ng-template>

      <th>
        ویرایش / حذف
      </th>
    </tr>
  </ng-template>
  <ng-template pTemplate="body" let-rowData let-columns="columns">
    <tr [pSelectableRow]="rowData">
      <td *ngFor="let col of columns">

        <div [ngSwitch]="getType(rowData[col.field])">
          <div *ngSwitchCase="'boolean'">
            <i *ngIf="rowData[col.field]" class="fa fa-check text-success"></i>
            <i *ngIf="!rowData[col.field]" class="fa fa-times text-danger"></i>
          </div>
          <div *ngSwitchCase="'object'">
            <div *ngIf="col.display" [innerHTML]="col.display(rowData)" >

            </div>
          </div>


          <div *ngSwitchDefault>
            {{rowData[col.field]}}
          </div>
        </div>

      </td>

      <ng-template [ngTemplateOutlet]="columnContent" [ngTemplateOutletContext]="{$implicit: rowData}"></ng-template>

      <td>
        <button class="btn btn-primary text-white" (click)="selectCarWithButton(rowData)">
          <i class="fa fa-search"></i>
        </button>
      </td>




    </tr>
  </ng-template>
  <ng-template pTemplate="summary" let-rowData>
    <div style="text-align:left">
      <button type="button" pButton icon="fa fa-plus" (click)="showDialogToAdd()" [label]="AddButtonTitle"></button>
    </div>
  </ng-template>
</p-table>

<p-dialog [header]="newModel  ? newFormHeader : editFormHeader" [(visible)]="displayDialog" [responsive]="true"
          showEffect="fade" [modal]="true"
          [style]="{width: '40vw'}">
  <p-messages [value]="msgs"></p-messages>

  <form [formGroup]="form" (ngSubmit)="onSubmit()">

    <div class="row d-flex" *ngIf="model">
      <div class="col-md-6" *ngFor="let field of formFields">
        <label *ngIf="field.type != 'checkbox'">{{ field.label }}</label>

        <div [ngSwitch]="field.controlType">


           <div
             *ngSwitchCase="'textbox'"
           >
             <div *ngIf="field.type != 'checkbox'">
               <input
                 [formControlName]="field.name"
                 [class]=" field.type != 'checkbox' ?  'form-control' : 'form-check-input'"
                 [id]="field.name"
                 [type]="field.type"
               />

             </div>
             <div *ngIf="field.type =='checkbox'">
               <label >

                 <p-inputSwitch
                   [formControlName]="field.name"
                 >
                 </p-inputSwitch>
               <!--  <input
                   [formControlName]="field.name"
                   [class]=" field.type != 'checkbox' ?  'form-control' : 'form-check-input'"
                   [id]="field.name"
                   type="checkbox"

                 />-->
                 <span class="ms-2 mb-2">{{ field.label }}</span>
               </label>
             </div>
           </div>


          <textarea
            *ngSwitchCase="'textarea'"
            class="form-control"
            [formControlName]="field.name"
            [id]="field.name"
          ></textarea>

          <select
            *ngSwitchCase="'dropdown'"
            [formControlName]="field.name"
            class="form-control"
            [id]="field.name"
          >
            <option *ngFor="let option of field.options" [value]="option.value">
              {{ option.label }}
            </option>
          </select>

           <!-- <p-listbox *ngSwitchCase="'listbox'" [options]="field.options"
                       [multiple]="true" [checkbox]="true" [filter]="true"
                       [formControlName]="field.name" optionLabel="label"></p-listbox>-->

          <p-listbox  *ngSwitchCase="'listbox'"  [options]="field.options"
                      [formControlName]="field.name"
                     optionLabel="label"

                      [selectAll]="true"
                      [filter]="true"
                      [multiple]="true"
                      [checkbox]="true"
                      [showToggleAll]="true"
          ></p-listbox>


        </div>




        <div *ngIf="form.get(field.name)?.invalid && form.get(field.name)?.touched">
          {{ field.validationMessage }}
        </div>


      </div>

      <ng-content select="[formContent]"></ng-content>


    </div>



  </form>
  <ng-template pTemplate="footer">
    <div class="ui-dialog-buttonpane ui-helper-clearfix">
      <button *ngIf="model" type="button" pButton icon="fa fa-check" (click)="save()" label="ثبت"></button>
      <button *ngIf="model" type="button" class="bg-danger text-white" pButton icon="fa fa-close" (click)="delete()" label="حذف"></button>

      <button *ngIf="model" type="button" class="bg-secondary text-white" pButton  (click)="this.model = null;this.displayDialog = false;" label="بستن"></button>
    </div>
  </ng-template>

</p-dialog>
